<div [class]="containerClasses">
  <form 
    [id]="formId"
    [class]="formClasses"
    [formGroup]="formGroup!"
    [attr.novalidate]="noValidate ? '' : null"
    [attr.autocomplete]="autoComplete ? 'on' : 'off'"
    [attr.aria-label]="ariaLabel"
    [attr.aria-describedby]="ariaDescribedBy"
    (ngSubmit)="onFormSubmit($event)">
    
    <!-- Form Content -->
    <div class="form-content" 
         [style.grid-template-columns]="layout === 'grid' ? 'repeat(' + gridColumns + ', 1fr)' : null">
      
      <!-- Sections Layout -->
      <ng-container *ngIf="sections.length > 0; else defaultContent">
        <div *ngFor="let section of sections" 
             [class]="getSectionClasses(section)"
             [attr.id]="section.id">
          
          <!-- Section Header -->
          <div class="section-header" 
               *ngIf="section.title || section.description"
               [class.clickable]="section.collapsible"
               (click)="section.collapsible ? toggleSection(section) : null">
            
            <div class="section-header-content">
              <h3 class="section-title" *ngIf="section.title">
                {{ section.title }}
                <span class="required-indicator" 
                      *ngIf="showRequiredIndicator">*</span>
              </h3>
              
              <p class="section-description" *ngIf="section.description">
                {{ section.description }}
              </p>
            </div>
            
            <!-- Toggle Icon -->
            <div class="section-toggle" *ngIf="section.collapsible">
              <svg class="toggle-icon" 
                   [class.rotated]="!section.collapsed"
                   width="16" 
                   height="16" 
                   viewBox="0 0 16 16" 
                   fill="none">
                <path d="M6 12L10 8L6 4" 
                      stroke="currentColor" 
                      stroke-width="2" 
                      stroke-linecap="round" 
                      stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
          
          <!-- Section Content -->
          <div class="section-content" 
               [class.collapsed]="section.collapsed"
               [attr.aria-hidden]="section.collapsed">
            
            <!-- Section Fields Container -->
            <div class="section-fields" 
                 [class]="'layout-' + layout">
              <ng-content select="[slot='section-' + section.id + '-content']"></ng-content>
            </div>
          </div>
        </div>
      </ng-container>
      
      <!-- Default Content (No Sections) -->
      <ng-template #defaultContent>
        <div class="form-fields" [class]="'layout-' + layout">
          <ng-content></ng-content>
        </div>
      </ng-template>
    </div>
    
    <!-- Form Actions -->
    <div class="form-actions">
      <!-- Submit State Messages -->
      <div class="form-messages" *ngIf="hasErrors || isSuccess">
        <div class="error-message" *ngIf="hasErrors">
          <svg class="message-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
            <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/>
            <path d="M8 4v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 12h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          <span>Please fix the errors below and try again.</span>
        </div>
        
        <div class="success-message" *ngIf="isSuccess">
          <svg class="message-icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
            <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2"/>
            <path d="M5.5 8.5L7 10L10.5 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>Form submitted successfully!</span>
        </div>
      </div>
      
      <!-- Action Buttons -->
      <div class="action-buttons">
        <button type="button" 
                class="button secondary"
                *ngIf="showCancel"
                (click)="onFormCancel()">
          {{ cancelText }}
        </button>
        
        <button type="submit" 
                class="button primary"
                [class.loading]="isSubmitting"
                [disabled]="isSubmitDisabled">
          
          <!-- Loading State -->
          <span class="button-content" *ngIf="!isSubmitting">
            {{ submitText }}
          </span>
          
          <!-- Loading Spinner -->
          <span class="button-content loading" *ngIf="isSubmitting">
            <svg class="loading-spinner" width="16" height="16" viewBox="0 0 16 16" fill="none">
              <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-dasharray="31.416" stroke-dashoffset="31.416">
                <animate attributeName="stroke-dasharray" dur="2s" values="0 31.416;15.708 15.708;0 31.416" repeatCount="indefinite"/>
                <animate attributeName="stroke-dashoffset" dur="2s" values="0;-15.708;-31.416" repeatCount="indefinite"/>
              </circle>
            </svg>
            Submitting...
          </span>
        </button>
      </div>
    </div>
  </form>
</div>